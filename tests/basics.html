<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
		<title>infimath.js - Arbitrary-precision math library</title>
		<script src="../src/infimath.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="../../ethproductions.github.io/style/style.css">
		<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro|Source+Code+Pro" rel="stylesheet"> 
		
		<style>
			* {
				font-family: "Source Sans Pro", sans-serif;
			}
			
			th, td {
				text-align: left;
			}
			
			.mono {
				font-family: "Source Code Pro", monospace;
			}
		</style>
	<head>
	<body>
		<h2><a href="../index.html">infimath.js</a></h2>
		<p id="errors"></p>
		
		<script>
			function log() {
				debug && console.log.apply(console, arguments);
			}
			function warn() {
				var args = [].slice.call(arguments);
				console.warn.apply(console, args);
				var i = 1;
				args[0].replace && (document.getElementById("errors").innerHTML += arguments[0].replace(/%[dsf]|%\.(\d+)f/g, function(x, y){
					return y ? (+args[i++]).toFixed(+y) : args[i++];
				}) + "<br>");
			}
			
			/////////////////// TESTS ///////////////////
			
			var tests = [
				// [test, data, decs, sign, toString] or
				// [test, true] if it should error.
			
				/************ Basic tests ************/
			
				// Positive
				[     "0", [  0   ],  0,  0,      "0"],
				[     "1", [  1   ],  0,  1,      "1"],
				[    "10", [ 10   ],  0,  1,     "10"],
				[   "100", [100   ],  0,  1,    "100"],
				[  "1000", [  1   ], -1,  1,   "1000"],
				[  "1234", [234, 1],  0,  1,   "1234"],
				[ "1,234", [234, 1],  0,  1,   "1234"],
				[ "1 234", [234, 1],  0,  1,   "1234"],
				[ "1_234", [234, 1],  0,  1,   "1234"],
				[ "  1  ", [  1   ],  0,  1,      "1"],
				[ "1,2,3", [123   ],  0,  1,    "123"],
			
				// Negative
				[    "-0", [  0   ],  0,  0,      "0"],
				[    "-1", [  1   ],  0, -1,     "-1"],
				[   "-10", [ 10   ],  0, -1,    "-10"],
				[  "-100", [100   ],  0, -1,   "-100"],
				[ "-1000", [  1   ], -1, -1,  "-1000"],
			
				// Decimal
				[   "0.0", [  0   ],  0,  0,      "0"],
				[   "0.1", [100   ],  1,  1,    "0.1"],
				[    ".1", [100   ],  1,  1,    "0.1"],
				[   ".01", [ 10   ],  1,  1,   "0.01"],
				[  ".001", [  1   ],  1,  1,  "0.001"],
				[ ".0001", [100   ],  2,  1, "0.0001"],
				["-.123456789", [789, 456, 123], 3, -1, "-0.123456789"],
			
				[      "1.2", [200,        1],  1,  1,      "1.2"],
				[    "12.34", [340, 12      ],  1,  1,    "12.34"],
				[  "123.456", [456, 123     ],  1,  1,  "123.456"],
				["1234.5678", [800,567,234,1],  2,  1,"1234.5678"],
			
				/************ Scientific notation tests ************/
			
				// Basic
				[    "0e0", [  0    ],  0,  0,        "0"],
				[    "0e1", [  0    ],  0,  0,        "0"],
				[    "1e0", [  1    ],  0,  1,        "1"],
				[    "1e1", [ 10    ],  0,  1,       "10"],
				[    "1e2", [100    ],  0,  1,      "100"],
				[    "1e3", [  1    ], -1,  1,     "1000"],
				[    "1e4", [ 10    ], -1,  1,    "10000"],
				[    "1e5", [100    ], -1,  1,   "100000"],
				[    "1e6", [  1    ], -2,  1,  "1000000"],
				[ "1234e5", [400,123], -1,  1,"123400000"],
				[".1234e5", [340, 12],  0,  1,    "12340"],
			
				// Positive exponent
				[    "1e+0", [  1    ],  0,  1,        "1"],
				[    "1e+1", [ 10    ],  0,  1,       "10"],
				[    "1e+2", [100    ],  0,  1,      "100"],
				[    "1e+3", [  1    ], -1,  1,     "1000"],
				[    "1e+4", [ 10    ], -1,  1,    "10000"],
				[    "1e+5", [100    ], -1,  1,   "100000"],
				[    "1e+6", [  1    ], -2,  1,  "1000000"],
				[ "1234e+5", [400,123], -1,  1,"123400000"],
				[".1234e+5", [340, 12],  0,  1,    "12340"],
			
				// Negative exponent
				[    "1e-0", [  1   ],  0,  1,          "1"],
				[    "1e-1", [100   ],  1,  1,        "0.1"],
				[    "1e-2", [ 10   ],  1,  1,       "0.01"],
				[    "1e-3", [  1   ],  1,  1,      "0.001"],
				[    "1e-4", [100   ],  2,  1,     "0.0001"],
				[    "1e-5", [ 10   ],  2,  1,    "0.00001"],
				[    "1e-6", [  1   ],  2,  1,   "0.000001"],
				[".1234e-5", [234, 1],  3,  1,"0.000001234"],
				[ "1234e-5", [340,12],  2,  1,    "0.01234"],
			
				// Negative number, positive exponent
				[    "-1e+0", [  1   ],  0, -1,        "-1"],
				[    "-1e+1", [ 10   ],  0, -1,       "-10"],
				[    "-1e+2", [100   ],  0, -1,      "-100"],
				[    "-1e+3", [  1   ], -1, -1,     "-1000"],
				[    "-1e+4", [ 10   ], -1, -1,    "-10000"],
				[    "-1e+5", [100   ], -1, -1,   "-100000"],
				[    "-1e+6", [  1   ], -2, -1,  "-1000000"],
				[ "-1234e+5", [400,123],-1, -1,"-123400000"],
				["-.1234e+5", [340,12],  0, -1,    "-12340"],
			
				// Negative number, negative exponent
				[    "-1e-0", [  1   ],  0, -1,          "-1"],
				[    "-1e-1", [100   ],  1, -1,        "-0.1"],
				[    "-1e-2", [ 10   ],  1, -1,       "-0.01"],
				[    "-1e-3", [  1   ],  1, -1,      "-0.001"],
				[    "-1e-4", [100   ],  2, -1,     "-0.0001"],
				[    "-1e-5", [ 10   ],  2, -1,    "-0.00001"],
				[    "-1e-6", [  1   ],  2, -1,   "-0.000001"],
				["-.1234e-5", [234, 1],  3, -1,"-0.000001234"],
				[ "-1234e-5", [340,12],  2, -1,    "-0.01234"],
			
				// Special cases
				[ ".1e+1", [  1   ],  0,  1,     "1"],
				[ ".1e+2", [ 10   ],  0,  1,    "10"],
				[".12e+2", [ 12   ],  0,  1,    "12"],
				[ "1.e-1", [100   ],  1,  1,   "0.1"],
				[ ".1e-1", [ 10   ],  1,  1,  "0.01"],
				[ "10e-1", [  1   ],  0,  1,     "1"],
				["12.e-2", [120   ],  1,  1,  "0.12"],
				[ "1.e-2", [ 10   ],  1,  1,  "0.01"],
				[ ".1e-2", [  1   ],  1,  1, "0.001"],
				["100e-2", [  1   ],  0,  1,     "1"],
				["120e-2", [200, 1],  1,  1,   "1.2"],
				[ "12e-2", [120   ],  1,  1,  "0.12"],
			
				/************ Invalid syntax tests ************/
			
				[ "error", true],
				[     ".", true],
				[    "1e", true],
				[   "1e+", true],
				[   "1e-", true],
				[   "e+1", true],
				[   "e-1", true],
				[  ".e+1", true],
			];
			
			var n = 0,
					s = 0,
					t = 0,
					debug = true;
			for (var i of tests) {
				t++;
				if (4 in i) t++;
				try {
					n = BigNumber(i[0]);
				} catch (e) {
					if (i[1] === true) {
						log('Parsing of "%s" succeeded. (Throws error)', i[0]);
						s++;
					} else {
						warn('Parsing of "%s" failed. (Throws error)', i[0]);
						warn(e);
					}
					continue;
				}
				if (n.data + "" === i[1] + "" && n.decs === i[2] && n.sign === i[3]) {
					log('Parsing of "%s" succeeded. {data: [%s], decs: %d, sign: %d}', i[0], n.data, n.decs, n.sign);
					s++;
				} else {
					warn('Parsing of "%s" failed. {data: [%s], decs: %d, sign: %d}', i[0], n.data, n.decs, n.sign);
					if (n.data + "" !== i[1] + "") {
						warn("- data: [%s] should be [%s]", n.data, i[1]);
					}
					if (n.decs !== i[2]) {
						warn("- decs: %s should be %s", n.decs, i[2]);
					}
					if (n.sign !== i[3]) {
						warn("- sign: %s should be %s", n.sign, i[3]);
					}
				}
				n += "";
				if (n === i[4]) {
					log('BigNumber("%s").toString() succeeded. ("%s")', i[0], n);
					s++;
				} else {
					warn('BigNumber("%s").toString() failed. ("%s"; expected "%s")', i[0], n, i[4]);
				}
			}
			warn("");
			warn("%d/%d tests successful. (%.2f%)", s, t, s/t*100);
			warn("See browser console for more information.");
		</script>
	</body>
</html>
