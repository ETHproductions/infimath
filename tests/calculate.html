<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>calculate() tests | infimath.js</title>
		<script src="../src/infimath.js" type="text/javascript"></script>
		<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro|Source+Code+Pro" rel="stylesheet"> 
		
		<style>
			* {
				font-family: "Source Sans Pro", sans-serif;
			}
			
			th, td {
				text-align: left;
			}
			
			.mono {
				font-family: "Source Code Pro", monospace;
				font-size: 0.8em;
			}
		</style>
	<head>
	<body>
		<h2><a href="../index.html">infimath.js</a></h2>
		<p>Tests of <span class="mono">BigNumber.prototype.calculate()</span></p>
		<p id="errors" class="mono"></p>
		Test some code here:<br>
		<textarea id="code" class="mono" rows=7 cols=50>BigNumber(1e+6).plus(1e-6).calculate()</textarea><br>
		<button onclick="$('result').innerHTML=eval($('code').value)">Go</button><br>
		<p id="result" class="mono"></p>
		
		<script>
			function $(x){return document.getElementById(x)}
			function log() {
				console.log.apply(console, arguments);
			}
			function warn() {
				var args = [].slice.call(arguments);
				console.warn.apply(console, args);
				var i = 1, m = args[0];
				document.getElementById("errors").innerHTML += (m.replace ? m.replace(/%[dsf]|%\.(\d+)f/g, function(x, y) {
					return y ? (+args[i++]).toFixed(+y) : args[i++];
				}) : m.stack.replace(/\n /g, "<br>&nbsp;")) + "<br>";
			}
			
			// tests.map(function(x){return BigNumber.prototype[x[1]].apply(BigNumber(x[0]),x[2]).calculate()}).join("<br>")
			/////////////////// TESTS ///////////////////
			
			var tests = [
				// Each test is run as BigNumber(a)[b](c) === {data: d, decs: e, sign: f}
				// [a, b, [c], d, e, f]
			
				/************ Plus tests ************/
				
				// 0 + any
				[    "0", "plus", [    0], [   0],  0,  0],
				[    "0", "plus", [    1], [   1],  0,  1],
				[    "0", "plus", [   -1], [   1],  0, -1],
				[    "1", "plus", [    0], [   1],  0,  1],
				[   "-1", "plus", [    0], [   1],  0, -1],
				
				// pos + pos
				[    "1", "plus", [    1], [   2],  0,  1],
				[    "1", "plus", [  999], [   1], -1,  1],
				[    "1", "plus", [ 1000], [1, 1],  0,  1],
				[  "999", "plus", [    1], [   1], -1,  1],
				[ "1000", "plus", [    1], [1, 1],  0,  1],
				
				// pos + neg
				[    "1", "plus", [   -1], [   0],  0,  0],
				[    "1", "plus", [   -2], [   1],  0, -1],
				[    "1", "plus", [-1001], [   1], -1, -1],
				[    "1", "plus", [-1002], [1, 1],  0, -1],
				[    "1", "plus", [-1003], [2, 1],  0, -1],
				[    "1", "plus", [-1000001], [1], -2, -1],
				[    "1", "plus", [-1000002], [1, 0, 1],  0, -1],
				["1000001", "plus", [-1], [   1], -2,  1],
				["1000002", "plus", [-1], [1, 0, 1],  0,  1],
				
				// neg + pos
				[   "-1", "plus", [    1], [   0],  0,  0],
				[   "-1", "plus", [    2], [   1],  0,  1],
				[   "-1", "plus", [ 1001], [   1], -1,  1],
				[   "-1", "plus", [ 1002], [1, 1],  0,  1],
				[   "-1", "plus", [ 1003], [2, 1],  0,  1],
				[   "-1", "plus", [1000001], [1],  -2,  1],
				[   "-1", "plus", [1000002], [1, 0, 1],  0,  1],
				["-1000001", "plus", [1], [   1], -2, -1],
				["-1000002", "plus", [1], [1, 0, 1],  0, -1],
				
				// neg + neg
				[   "-1", "plus", [   -1], [   2],  0, -1],
				[   "-1", "plus", [ -999], [   1], -1, -1],
				[   "-1", "plus", [-1000], [1, 1],  0, -1],
				
				// dec + dec
				[    "1", "plus", [  1.1], [100, 2],  1,  1],
				[  "1.1", "plus", [    1], [100, 2],  1,  1],
				[  "1.1", "plus", [  1.1], [200, 2],  1,  1],
				[ "7.86", "plus", [  2.4], [260,10],  1,  1],
				[  "0.1", "plus", [999.9], [     1], -1,  1],
				["999.9", "plus", [  0.1], [     1], -1,  1],
				
				
				/************ Minus tests ************/
				
				// 0 - any or any - 0
				[   "0", "minus", [    0], [   0],  0,  0],
				[   "0", "minus", [    1], [   1],  0, -1],
				[   "0", "minus", [   -1], [   1],  0,  1],
				[   "1", "minus", [    0], [   1],  0,  1],
				[  "-1", "minus", [    0], [   1],  0, -1],
				
				// pos - pos
				[   "1", "minus", [    1], [   0],  0,  0],
				[   "1", "minus", [    2], [   1],  0, -1],
				[   "1", "minus", [ 1001], [   1], -1, -1],
				[   "1", "minus", [ 1002], [1, 1],  0, -1],
				["1001", "minus", [    1], [   1], -1,  1],
				["1002", "minus", [    1], [1, 1],  0,  1],
				
				// pos - neg
				[   "1", "minus", [   -1], [   2],  0,  1],
				[   "1", "minus", [ -999], [   1], -1,  1],
				[   "1", "minus", [-1000], [1, 1],  0,  1],
				[   "1", "minus", [ -999999], [1], -2,  1],
				[   "1", "minus", [-1000000], [1, 0, 1],  0,  1],
				[ "999999", "minus", [-1], [   1], -2,  1],
				["1000000", "minus", [-1], [1, 0, 1],  0,  1],
				
				// neg - pos
				[  "-1", "minus", [    1], [   2],  0,  -1],
				[  "-1", "minus", [  999], [   1], -1,  -1],
				[  "-1", "minus", [ 1000], [1, 1],  0,  -1],
				[  "-1", "minus", [ 999999], [1], -2,  -1],
				[  "-1", "minus", [1000000], [1, 0, 1],  0,  -1],
				[ "-999999", "minus", [1], [   1], -2,  -1],
				["-1000000", "minus", [1], [1, 0, 1],  0,  -1],
				
				// neg - neg
				[   "-1", "minus", [   -1], [   0],  0,  0],
				[   "-1", "minus", [   -2], [   1],  0,  1],
				[   "-1", "minus", [-1001], [   1], -1,  1],
				[   "-1", "minus", [-1002], [1, 1],  0,  1],
				["-1000", "minus", [   -1], [ 999],  0, -1],
				["-1001", "minus", [   -1], [   1], -1, -1],
				
				// dec - dec
				[     "1", "minus", [  1.1], [   100],  1, -1],
				[   "1.1", "minus", [    1], [   100],  1,  1],
				[   "1.1", "minus", [  1.1], [     0],  0,  0],
				[  "7.86", "minus", [  2.4], [460, 5],  1,  1],
				[  "-0.1", "minus", [999.9], [     1], -1, -1],
				["-999.9", "minus", [  0.1], [     1], -1, -1],
			];
			
			var n = 0,
				s = 0,
				t = 0;
			for (var i of tests) {
				t++;
				try {
					n = BigNumber.prototype[i[1]].apply(BigNumber(i[0]), i[2]).calculate();
				} catch (e) {
					warn('BigNumber("%s").%s(%d) failed. (Throws error)', i[0], i[1], i[2]);
					warn(e);
					continue;
				}
				if (n.data + "" === i[3] + "" && n.decs === i[4] && n.sign === i[5]) {
					log('BigNumber("%s").%s(%d) succeeded. {data: [%s], decs: %d, sign: %d}', i[0], i[1], i[2], n.data, n.decs, n.sign);
					s++;
				} else {
					warn('BigNumber("%s").%s(%d) failed. {data: [%s], decs: %d, sign: %d}', i[0], i[1], i[2], n.data, n.decs, n.sign);
					if (n.data + "" !== i[3] + "") {
						warn("- data: [%s] should be [%s]", n.data, i[3]);
					}
					if (n.decs !== i[4]) {
						warn("- decs: %s should be %s", n.decs, i[4]);
					}
					if (n.sign !== i[5]) {
						warn("- sign: %s should be %s", n.sign, i[5]);
					}
				}
			}
			t !== s && warn("");
			warn("%d/%d tests successful. (%.2f%)", s, t, s/t*100);
			warn("See browser console for more information.");
		</script>
	</body>
</html>
